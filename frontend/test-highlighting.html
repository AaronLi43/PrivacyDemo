<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensitive Text Highlighting Test</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .test-textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            margin: 10px 0;
        }
        .test-button {
            background: #AF125A;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #8a0e47;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç Sensitive Text Highlighting Test</h1>
        <p>This page tests the red underline highlighting for sensitive text in the privacy analysis stage.</p>
        
        <h3>Test Textarea with Sensitive Information:</h3>
        <textarea class="test-textarea" id="test-textarea">
My name is John Smith and I live at 123 Main Street, New York, NY 10001. My phone number is 555-123-4567 and my email is john.smith@email.com. I work as a software engineer at Tech Corp.

Text with new placeholders: I graduated from [AFFILIATION1] with a degree in [EDUCATIONAL_RECORD1]. My name is [NAME1] and I work at [AFFILIATION2]. My email is [EMAIL1] and phone is [PHONE_NUMBER1].

Text with all new PII categories: I'm from [GEOLOCATION1], my ethnicity is [DEMOGRAPHIC_ATTRIBUTE1], I was born on [TIME1], I have [HEALTH_INFORMATION1], my salary is [FINANCIAL_INFORMATION1], and I studied [EDUCATIONAL_RECORD2].

Text with new format placeholders: I have a [Key1], I'm from [Geolocation1], I work at [Affiliation1], my ethnicity is [Demographic_Attribute1], I was born on [Time1], I have [Health_Information1], my salary is [Financial_Information1], and I studied [Education_Record1].
        </textarea>
        
        <div>
            <button class="test-button" onclick="testHighlighting()">Test Highlighting</button>
            <button class="test-button" onclick="clearHighlighting()">Clear Highlighting</button>
        </div>
        
        <div id="test-results" style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
            <h4>Test Results:</h4>
            <div id="results-content">Click "Test Highlighting" to see results...</div>
        </div>
    </div>

    <script>
        // Simplified version of the highlighting functions for testing
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function highlightSensitiveText(text, privacyResult) {
            if (!privacyResult || !privacyResult.privacy_issue) {
                return text;
            }

            let highlightedText = text;

            // 1. Highlight original sensitive text if available
            let sensitiveText = privacyResult.sensitive_text;
            
            // Fallback to extracting from suggestion if sensitive_text is not available
            if (!sensitiveText && privacyResult.suggestion) {
                const beforeAfterPattern = /^Before:\s*["']([^"']*)["']\s*After:\s*["']([^"']*)["']$/s;
                const beforeAfterPatternAlt = /^Before:\s*"([^"]*)"\s*After:\s*"([^"]*)"$/s;
                const beforeAfterPatternFlexible = /Before:\s*["']([^"']*)["']\s*After:\s*["']([^"']*)["']/s;
                
                if (beforeAfterPattern.test(privacyResult.suggestion)) {
                    const match = privacyResult.suggestion.match(beforeAfterPattern);
                    if (match) {
                        sensitiveText = match[1];
                    }
                } else if (beforeAfterPatternAlt.test(privacyResult.suggestion)) {
                    const match = privacyResult.suggestion.match(beforeAfterPatternAlt);
                    if (match) {
                        sensitiveText = match[1];
                    }
                } else if (beforeAfterPatternFlexible.test(privacyResult.suggestion)) {
                    const match = privacyResult.suggestion.match(beforeAfterPatternFlexible);
                    if (match) {
                        sensitiveText = match[1];
                    }
                }
            }

            if (sensitiveText) {
                // Escape special regex characters in the sensitive text
                const escapedSensitiveText = escapeRegex(sensitiveText);
                
                // Create a regex that matches the sensitive text (case-insensitive)
                const regex = new RegExp(`(${escapedSensitiveText})`, 'gi');
                
                // Replace the sensitive text with highlighted version
                highlightedText = highlightedText.replace(regex, '<span class="sensitive-text-highlight">$1</span>');
            }

            // 2. Highlight placeholder patterns (new placeholders like [AFFILIATION1], [EDUCATIONAL_RECORD1], etc.)
            const placeholderPatterns = [
                /\[AFFILIATION\d+\]/g,
                /\[EDUCATIONAL_RECORD\d+\]/g,
                /\[NAME\d+\]/g,
                /\[EMAIL\d+\]/g,
                /\[PHONE_NUMBER\d+\]/g,
                /\[ADDRESS\d+\]/g,
                /\[SSN\d+\]/g,
                /\[FINANCIAL_INFORMATION\d+\]/g,
                /\[TIME\d+\]/g,
                /\[GEOLOCATION\d+\]/g,
                /\[DEMOGRAPHIC_ATTRIBUTE\d+\]/g,
                /\[HEALTH_INFORMATION\d+\]/g,
                /\[IP_ADDRESS\d+\]/g,
                /\[URL\d+\]/g,
                /\[DRIVERS_LICENSE\d+\]/g,
                /\[PASSPORT_NUMBER\d+\]/g,
                /\[TAXPAYER_IDENTIFICATION_NUMBER\d+\]/g,
                /\[ID_NUMBER\d+\]/g,
                /\[USERNAME\d+\]/g,
                /\[KEYS\d+\]/g,
                // New format patterns as requested
                /\[Key\d+\]/g,
                /\[Geolocation\d+\]/g,
                /\[Affiliation\d+\]/g,
                /\[Demographic_Attribute\d+\]/g,
                /\[Time\d+\]/g,
                /\[Health_Information\d+\]/g,
                /\[Financial_Information\d+\]/g,
                /\[Education_Record\d+\]/g,
                // Legacy patterns for backward compatibility
                /\[Address\d+\]/g,
                /\[Name\d+\]/g,
                /\[Phone\d+\]/g,
                /\[Email\d+\]/g,
                /\[CreditCard\d+\]/g,
                /\[Date\d+\]/g
            ];

            // Apply highlighting to all placeholder patterns
            placeholderPatterns.forEach(pattern => {
                highlightedText = highlightedText.replace(pattern, '<span class="sensitive-text-highlight">$&</span>');
            });

            return highlightedText;
        }

        function testHighlighting() {
            const textarea = document.getElementById('test-textarea');
            const originalText = textarea.value;
            
            // Create test privacy results using the sensitive_text field from backend
            const privacyResults = [
                {
                    privacy_issue: true,
                    type: 'NAME',
                    sensitive_text: 'John Smith',
                    suggestion: 'Before: "My name is John Smith" After: "My name is [REDACTED]"'
                },
                {
                    privacy_issue: true,
                    type: 'ADDRESS',
                    sensitive_text: '123 Main Street, New York, NY 10001',
                    suggestion: 'Before: "I live at 123 Main Street, New York, NY 10001" After: "I live at [REDACTED]"'
                },
                {
                    privacy_issue: true,
                    type: 'PHONE_NUMBER',
                    sensitive_text: '555-123-4567',
                    suggestion: 'Before: "My phone number is 555-123-4567" After: "My phone number is [REDACTED]"'
                },
                {
                    privacy_issue: true,
                    type: 'EMAIL',
                    sensitive_text: 'john.smith@email.com',
                    suggestion: 'Before: "my email is john.smith@email.com" After: "my email is [REDACTED]"'
                },
                {
                    privacy_issue: true,
                    type: 'AFFILIATION',
                    sensitive_text: 'Tech Corp',
                    suggestion: 'Before: "I work at Tech Corp" After: "I work at [REDACTED]"'
                }
            ];

            let highlightedText = originalText;
            let results = [];

            // Apply highlighting for each privacy issue
            privacyResults.forEach((result, index) => {
                const beforeHighlighting = highlightedText;
                highlightedText = highlightSensitiveText(highlightedText, result);
                
                if (highlightedText !== beforeHighlighting) {
                    results.push(`‚úÖ ${result.type}: Found and highlighted`);
                } else {
                    results.push(`‚ùå ${result.type}: Not found or not highlighted`);
                }
            });

            // Create inline highlighted div to replace the textarea
            const container = textarea.parentElement;
            
            // Remove any existing highlighted div
            const existingHighlighted = container.querySelector('.message-edit-input-highlighted');
            if (existingHighlighted) {
                existingHighlighted.remove();
            }

            // Create new contenteditable div for inline highlighting
            const highlightedDiv = document.createElement('div');
            highlightedDiv.className = 'message-edit-input-highlighted';
            highlightedDiv.contentEditable = true;
            highlightedDiv.innerHTML = highlightedText;
            
            // Copy the textarea's computed styles to match exactly
            const textareaStyles = window.getComputedStyle(textarea);
            highlightedDiv.style.cssText = `
                width: 100%;
                min-height: 100px;
                background: ${textareaStyles.backgroundColor};
                border: ${textareaStyles.border};
                border-radius: ${textareaStyles.borderRadius};
                padding: ${textareaStyles.padding};
                font-size: ${textareaStyles.fontSize};
                font-family: ${textareaStyles.fontFamily};
                line-height: ${textareaStyles.lineHeight};
                overflow-y: auto;
                color: ${textareaStyles.color};
                white-space: pre-wrap;
                word-wrap: break-word;
                resize: none;
                outline: none;
                box-sizing: border-box;
                margin: 0;
            `;
            
            // Hide the original textarea and show the highlighted version
            textarea.style.display = 'none';
            container.appendChild(highlightedDiv);

            // Test highlighting for new placeholder patterns specifically
            const placeholderTestText = 'I graduated from [AFFILIATION1] with a degree in [EDUCATIONAL_RECORD1]. My name is [NAME1] and I work at [AFFILIATION2].';
            const placeholderHighlightedText = highlightSensitiveText(placeholderTestText, { privacy_issue: true });
            
            // Test highlighting for all new PII categories
            const newPiiTestText = 'I\'m from [GEOLOCATION1], my ethnicity is [DEMOGRAPHIC_ATTRIBUTE1], I was born on [TIME1], I have [HEALTH_INFORMATION1], my salary is [FINANCIAL_INFORMATION1], and I studied [EDUCATIONAL_RECORD2].';
            const newPiiHighlightedText = highlightSensitiveText(newPiiTestText, { privacy_issue: true });
            
            // Test highlighting for new format patterns
            const newFormatTestText = 'I have a [Key1], I\'m from [Geolocation1], I work at [Affiliation1], my ethnicity is [Demographic_Attribute1], I was born on [Time1], I have [Health_Information1], my salary is [Financial_Information1], and I studied [Education_Record1].';
            const newFormatHighlightedText = highlightSensitiveText(newFormatTestText, { privacy_issue: true });
            
            // Update results
            const resultsContent = document.getElementById('results-content');
            resultsContent.innerHTML = `
                <h5>Original Text Results:</h5>
                ${results.join('<br>')}
                
                <h5>New Placeholder Patterns Test:</h5>
                <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; background: white;">
                    <strong>Original:</strong> ${placeholderTestText}<br><br>
                    <strong>Highlighted:</strong> ${placeholderHighlightedText}
                </div>
                
                <h5>New PII Categories Test:</h5>
                <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; background: white;">
                    <strong>Original:</strong> ${newPiiTestText}<br><br>
                    <strong>Highlighted:</strong> ${newPiiHighlightedText}
                </div>
                
                <h5>New Format Patterns Test:</h5>
                <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; background: white;">
                    <strong>Original:</strong> ${newFormatTestText}<br><br>
                    <strong>Highlighted:</strong> ${newFormatHighlightedText}
                </div>
                
                <h5>Placeholder Test Results:</h5>
                <ul>
                    <li>‚úÖ AFFILIATION1 highlighted: ${placeholderHighlightedText.includes('sensitive-text-highlight') && placeholderHighlightedText.includes('[AFFILIATION1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ EDUCATIONAL_RECORD1 highlighted: ${placeholderHighlightedText.includes('sensitive-text-highlight') && placeholderHighlightedText.includes('[EDUCATIONAL_RECORD1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ NAME1 highlighted: ${placeholderHighlightedText.includes('sensitive-text-highlight') && placeholderHighlightedText.includes('[NAME1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ AFFILIATION2 highlighted: ${placeholderHighlightedText.includes('sensitive-text-highlight') && placeholderHighlightedText.includes('[AFFILIATION2]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ GEOLOCATION1 highlighted: ${newPiiHighlightedText.includes('sensitive-text-highlight') && newPiiHighlightedText.includes('[GEOLOCATION1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ DEMOGRAPHIC_ATTRIBUTE1 highlighted: ${newPiiHighlightedText.includes('sensitive-text-highlight') && newPiiHighlightedText.includes('[DEMOGRAPHIC_ATTRIBUTE1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ TIME1 highlighted: ${newPiiHighlightedText.includes('sensitive-text-highlight') && newPiiHighlightedText.includes('[TIME1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ HEALTH_INFORMATION1 highlighted: ${newPiiHighlightedText.includes('sensitive-text-highlight') && newPiiHighlightedText.includes('[HEALTH_INFORMATION1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ FINANCIAL_INFORMATION1 highlighted: ${newPiiHighlightedText.includes('sensitive-text-highlight') && newPiiHighlightedText.includes('[FINANCIAL_INFORMATION1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ EDUCATIONAL_RECORD2 highlighted: ${newPiiHighlightedText.includes('sensitive-text-highlight') && newPiiHighlightedText.includes('[EDUCATIONAL_RECORD2]') ? 'PASSED' : 'FAILED'}</li>
                </ul>
                
                <h5>New Format Test Results:</h5>
                <ul>
                    <li>‚úÖ Key1 highlighted: ${newFormatHighlightedText.includes('sensitive-text-highlight') && newFormatHighlightedText.includes('[Key1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ Geolocation1 highlighted: ${newFormatHighlightedText.includes('sensitive-text-highlight') && newFormatHighlightedText.includes('[Geolocation1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ Affiliation1 highlighted: ${newFormatHighlightedText.includes('sensitive-text-highlight') && newFormatHighlightedText.includes('[Affiliation1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ Demographic_Attribute1 highlighted: ${newFormatHighlightedText.includes('sensitive-text-highlight') && newFormatHighlightedText.includes('[Demographic_Attribute1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ Time1 highlighted: ${newFormatHighlightedText.includes('sensitive-text-highlight') && newFormatHighlightedText.includes('[Time1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ Health_Information1 highlighted: ${newFormatHighlightedText.includes('sensitive-text-highlight') && newFormatHighlightedText.includes('[Health_Information1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ Financial_Information1 highlighted: ${newFormatHighlightedText.includes('sensitive-text-highlight') && newFormatHighlightedText.includes('[Financial_Information1]') ? 'PASSED' : 'FAILED'}</li>
                    <li>‚úÖ Education_Record1 highlighted: ${newFormatHighlightedText.includes('sensitive-text-highlight') && newFormatHighlightedText.includes('[Education_Record1]') ? 'PASSED' : 'FAILED'}</li>
                </ul>
            `;
        }

        function clearHighlighting() {
            const textarea = document.getElementById('test-textarea');
            const container = textarea.parentElement;
            
            // Remove highlighted div
            const highlightedDiv = container.querySelector('.message-edit-input-highlighted');
            if (highlightedDiv) {
                highlightedDiv.remove();
            }
            
            // Make textarea visible again
            textarea.style.display = '';
            
            // Clear results
            document.getElementById('results-content').innerHTML = 'Highlighting cleared...';
        }
    </script>
</body>
</html> 