<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Privacy Demo Study</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <!-- Step 1: Introduction Page -->
  <div id="introduction-page" class="step-page active">
    <div class="step-container">
      <div class="step-header">
        <h1><i class="fas fa-graduation-cap"></i> Welcome to the Privacy Demo Study</h1>
        <div class="step-indicator">
          <span class="step-number">1</span>
          <span class="step-label">Introduction</span>
        </div>
      </div>
      
      <div class="step-content">
        <div class="introduction-content">
          <div class="welcome-section">
            <h2>Study Overview</h2>
            <p>Welcome to our research study on <strong>using AI in job interviews</strong>. This study explores how people interact with AI chatbots when discussing sensitive topics and making decisions about sharing personal information.</p>
            <p>As AI becomes increasingly common in professional settings, including job interviews, we want to understand how people feel about sharing their experiences and opinions on this topic. You'll have a conversation with an AI chatbot about using AI during job interviews, and we'll explore how different privacy features affect your willingness to share information.</p>
          </div>

          <div class="study-details">
            <h3><i class="fas fa-info-circle"></i> What You'll Do</h3>
            <ul>
              <li>Have a conversation with an AI chatbot</li>
              <li>Answer questions about yourself and your experiences</li>
              <li>Make decisions about what information to share</li>
              <li>Complete a brief survey about your experience</li>
            </ul>
          </div>

          <div class="time-commitment">
            <h3><i class="fas fa-clock"></i> Time Commitment</h3>
            <p>This study will take approximately <strong>15-20 minutes</strong> to complete.</p>
          </div>

          <div class="compensation">
            <h3><i class="fas fa-gift"></i> Compensation</h3>
            <p>You will receive compensation through Prolific upon completion of this study.</p>
          </div>

          <div class="privacy-notice">
            <h3><i class="fas fa-shield-alt"></i> Privacy Notice</h3>
            <p>Your privacy is important to us. All data collected will be anonymized and used only for research purposes. You can withdraw from the study at any time.</p>
          </div>
        </div>
      </div>

      <div class="step-actions">
        <button id="start-study-btn" class="btn btn-primary">
          <i class="fas fa-arrow-right"></i> Begin Study
        </button>
      </div>
    </div>
  </div>

  <!-- Step 2: Consent Page -->
  <div id="consent-page" class="step-page">
    <div class="step-container">
      <div class="step-header">
        <h1><i class="fas fa-user-shield"></i> Informed Consent</h1>
        <div class="step-indicator">
          <span class="step-number">2</span>
          <span class="step-label">Consent</span>
        </div>
      </div>
      
      <div class="step-content">
        <div class="consent-content">
          <div class="consent-header">
            <h2>Northeastern University, Khoury College of Computer Science</h2>
            <p><strong>Name of Investigator(s):</strong> Prof. Tianshi Li, Ziwen Li</p>
            <p><strong>Title of Project:</strong> Understanding User Interactions with AI Chatbots for Information Sharing</p>
            <p><strong>Funded by:</strong> Northeastern University</p>
            <p><strong>Version date:</strong> 06/26/2025</p>
          </div>

          <div class="consent-intro">
            <p>We are inviting you to participate in a research study. Participating is voluntary; you do not have to participate if you do not want to. You can withdraw from the study at any time.</p>
          </div>

          <div class="consent-sections">
            <div class="consent-section">
              <h3><i class="fas fa-bullseye"></i> Purpose of the Study</h3>
              <p>The purpose of this study is to understand how people interact with AI chatbots when sharing personal stories or solving problems, especially when the chatbot offers features that let users review and edit their messages before submitting. Participating in this research study will include collecting necessary demographic data such as gender and age and using the chatbot interface developed by the research team to complete a list of research questions about using AI when doing a job interview. The chatbot-based task will take about 20-30 minutes to complete.</p>
              <p>You can skip questions that you do not want to answer or stop the chatbot-based task at any time.</p>
            </div>

            <div class="consent-section">
              <h3><i class="fas fa-lock"></i> Confidentiality</h3>
              <p>Your part in this study will be confidential. Only the researchers on this study will see the information about you. Personal identifiers will not be published or presented.</p>
            </div>

            <div class="consent-section">
              <h3><i class="fas fa-gift"></i> Compensation</h3>
              <p>When participants complete the chatbot-based task, they would be paid at an hourly rate of 50 US dollars. The payment would be completed via Prolific to keep the entire study anonymous. Their Prolific ID will be collected for the payment.</p>
            </div>

            <div class="consent-section">
              <h3><i class="fas fa-question-circle"></i> Contact Information</h3>
              <p>If you have any questions about this study, please contact Ziwen Li, <a href="mailto:li.ziw@northeastern.edu">li.ziw@northeastern.edu</a>, the person mainly responsible for the research. You can also contact Prof. Tianshi Li, <a href="mailto:tia.li@northeastern.edu">tia.li@northeastern.edu</a>, the Principal Investigator.</p>
              <p>If you have any questions about your rights in this research, you can contact the Northeastern University Department of Human Research at Tel: (773) 396-2327, or Email: <a href="mailto:IRBReview@northeastern.edu">IRBReview@northeastern.edu</a>. You may call anonymously if you want.</p>
            </div>
          </div>

          <div class="consent-checkbox">
            <label class="consent-checkbox-label">
              <input type="checkbox" id="consent-checkbox" required>
              <span class="checkmark"></span>
              I have read and understood the information above. I voluntarily agree to participate in this study.
            </label>
          </div>
        </div>
      </div>

      <div class="step-actions">
        <button id="back-to-intro-btn" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <button id="proceed-to-qualification-btn" class="btn btn-primary" disabled>
          <i class="fas fa-arrow-right"></i> I Consent - Continue
        </button>
      </div>
    </div>
  </div>

  <!-- Step 3: Qualification Page -->
  <div id="qualification-page" class="step-page">
    <div class="step-container">
      <div class="step-header">
        <h1><i class="fas fa-clipboard-check"></i> Qualification Questions</h1>
        <div class="step-indicator">
          <span class="step-number">3</span>
          <span class="step-label">Qualification</span>
        </div>
      </div>
      
      <div class="step-content">
        <div class="qualification-content">
          <div class="qualification-intro">
            <p>Please answer the following questions to ensure you qualify for this study. You must answer "Yes" to all questions to proceed. Participants who do not meet these criteria will be thanked and exited from the study.</p>
          </div>

          <div class="qualification-questions">
            <div class="qualification-question">
              <label for="qual-1">Are you 18 years of age or older?</label>
              <select id="qual-1" class="form-control qualification-select" required>
                <option value="">Select an answer...</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>

            <div class="qualification-question">
              <label for="qual-2">Do you speak and understand English fluently?</label>
              <select id="qual-2" class="form-control qualification-select" required>
                <option value="">Select an answer...</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>

            <div class="qualification-question">
              <label for="qual-3">Do you have basic experience using digital communication platforms (e.g., chat apps, social media, or online tools)?</label>
              <select id="qual-3" class="form-control qualification-select" required>
                <option value="">Select an answer...</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>

            <div class="qualification-question">
              <label for="qual-4">Are you comfortable sharing some personal information for research purposes?</label>
              <select id="qual-4" class="form-control qualification-select" required>
                <option value="">Select an answer...</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>

            <div class="qualification-question">
              <label for="qual-5">Do you agree to complete the entire study (approximately 20-30 minutes)?</label>
              <select id="qual-5" class="form-control qualification-select" required>
                <option value="">Select an answer...</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>
          </div>

          <div class="qualification-status" id="qualification-status">
            <p class="status-message">Please answer all questions with "Yes" to proceed.</p>
          </div>
        </div>
      </div>

      <div class="step-actions">
        <button id="back-to-consent-btn" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <button id="proceed-to-chat-btn" class="btn btn-primary" disabled>
          <i class="fas fa-arrow-right"></i> I Qualify - Start Chat
        </button>
      </div>
    </div>
  </div>

  <!-- Step 4: Main Chat Interface (Current Interface) -->
  <div id="chat-page" class="step-page">
    <div class="container">
      <!-- Header -->
      <header class="header">
        <div class="header-content">
          <div class="header-left">
            <h1 id="main-header-title"><i class="fas fa-lock"></i>Privacy Demo Study</h1>
          </div>
          <div class="header-right">
          </div>
        </div>
      </header>

      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-section">
          <h3><i class="fas fa-cog"></i> Configuration</h3>
          
          <!-- Mode Selection -->
          <div class="form-group">
            <label for="mode-select">Select Mode:</label>
            <select id="mode-select" class="form-control">
              <option value="naive">😊 Naive Mode</option>
              <option value="neutral">⚖️ Neutral Mode</option>
              <option value="featured">🔒 Featured Mode</option>
            </select>
          </div>

          <!-- Mode Info -->
          <div id="mode-info" class="info-box">
            <p><strong>💡 Naive Mode:</strong> You can edit your conversation log before exporting!</p>
          </div>

          <!-- Action Buttons -->
          <div class="button-group">
            <button id="reset-btn" class="btn btn-secondary">
              <i class="fas fa-redo"></i> Reset Conversation
            </button>
            <button id="exit-edit-btn" class="btn btn-warning" style="display: none;">
              <i class="fas fa-times"></i> Exit Edit Mode
            </button>
            <button id="show-congratulation-btn" class="btn btn-success">
              <i class="fas fa-trophy"></i> Show Congratulations
            </button>
          </div>
        </div>

        <!-- Statistics -->
        <div class="sidebar-section">
          <h3><i class="fas fa-chart-bar"></i> Statistics</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-label">Mode:</span>
              <span id="stat-mode" class="stat-value">😊 Naive</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Messages:</span>
              <span id="stat-messages" class="stat-value">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Step:</span>
              <span id="stat-step" class="stat-value">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Privacy Issues:</span>
              <span id="stat-privacy" class="stat-value">0</span>
            </div>
          </div>
        </div>

        <!-- API Status -->
        <div class="sidebar-section">
          <h3><i class="fas fa-key"></i> API Status</h3>
          <div id="api-status" class="status-indicator">
            <span class="status-dot"></span>
            <span class="status-text">Checking...</span>
          </div>
          <button id="test-api-btn" class="btn btn-sm btn-secondary">
            <i class="fas fa-vial"></i> Test Connection
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Two Column Layout for Privacy Analysis & Export Stage -->
        <div id="two-column-layout" class="two-column-layout" style="display:none;">
          <div class="left-column">
            <div class="edit-instructions" style="margin-bottom: 1rem; padding: 0.75rem; background-color: #f8f9fa; border-radius: 6px; border-left: 4px solid #28a745;">
              <p style="margin: 0; font-size: 0.9rem; color: #495057;"><i class="fas fa-edit"></i> <strong>Privacy Analysis Mode:</strong> You can edit any message in your conversation if you do not want that content shared. Click on any message to edit it.</p>
            </div>
            <div id="analysis-conversation-container" class="conversation-container">
              <div class="empty-state">
                <i class="fas fa-comment-dots"></i>
                <p>Start a conversation by typing a message below!</p>
              </div>
            </div>
          </div>
          <div class="right-column">
            <div id="privacy-analysis" class="privacy-analysis" style="display: none;">
              <div class="privacy-analysis-header">
                <h3><i class="fas fa-search"></i> Privacy Analysis Results</h3>
              </div>
              <div class="privacy-analysis-content">
                <div class="analysis-header">
                  <p>Privacy analysis has been completed on all messages. Click on red underlined text to see suggestions.</p>
                  <label style="display:block;margin:0.5em 0 1em 0;font-weight:normal;">
                    <input type="checkbox" id="privacy-filter-toggle" /> Show only messages with privacy issues
                  </label>
                </div>
                <div class="analysis-stats">
                  <div class="stat-card">
                    <span class="stat-number" id="total-messages">0</span>
                    <span class="stat-label">Total Messages</span>
                  </div>
                  <div class="stat-card">
                    <span class="stat-number" id="privacy-issues">0</span>
                    <span class="stat-label">Privacy Issues</span>
                  </div>
                </div>
                <div id="privacy-choices" class="privacy-choices">
                  <!-- Privacy choice buttons will be generated here -->
                </div>
                <div class="export-options">
                  <button id="export-comprehensive" class="btn btn-success">
                    <i class="fas fa-download"></i> Export Comprehensive Data
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Chat Interface (shown when not in analysis stage) -->
        <div class="chat-container">
          <div class="chat-header">
            <h2 id="chat-header-title"><i class="fas fa-comments"></i> Chat Interface</h2>
          </div>
          <div id="edit-instructions-chat" class="edit-instructions" style="margin-bottom: 1rem; padding: 0.75rem; background-color: #f8f9fa; border-radius: 6px; border-left: 4px solid #007bff; display: none;">
            <p style="margin: 0; font-size: 0.9rem; color: #495057;"><i class="fas fa-info-circle"></i> <strong>Edit Mode:</strong> You can edit any message in your conversation if you do not want that content shared. Click on any message to edit it.</p>
          </div>
          <div id="conversation-container" class="conversation-container">
            <div class="empty-state">
              <i class="fas fa-comment-dots"></i>
              <p>Start a conversation by typing a message below!</p>
            </div>
          </div>
          <div class="chat-input-container">
            <div class="input-group" id="chat-input-group">
              <input type="text" id="chat-input" placeholder="Type your message here..." class="form-control">
              <button id="send-btn" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i> Send
              </button>
            </div>
            <div id="edit-export-container" class="edit-export-container" style="display: none;">
              <div class="edit-export-buttons">
                <button id="edit-export-btn-main" class="btn btn-primary">
                  <i class="fas fa-edit"></i> Edit & Export
                </button>
                <button id="export-direct-btn-main" class="btn btn-success">
                  <i class="fas fa-download"></i> Export Direct
                </button>
                <button id="analyze-export-btn-main" class="btn btn-warning">
                  <i class="fas fa-search"></i> Analyze & Export
                </button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Action Buttons Panel - Fixed Position -->
    <div class="action-buttons-panel">
      <!-- Config Button -->
      <div class="config-button-container">
        <button id="toggle-sidebar-btn" class="btn btn-secondary toggle-sidebar-btn">
          <i class="fas fa-bars"></i> Hide Config
        </button>
      </div>

      <!-- Export Buttons -->
      <div id="export-buttons" class="export-buttons-container" style="display: none;">
        <button id="edit-export-btn" class="btn btn-primary" style="display: none;">
          <i class="fas fa-edit"></i> Edit & Export
        </button>
        <button id="export-direct-btn" class="btn btn-success">
          <i class="fas fa-download"></i> Export Direct
        </button>
        <button id="analyze-export-btn" class="btn btn-warning" style="display: none;">
          <i class="fas fa-search"></i> Analyze & Export
        </button>
      </div>
    </div>
  </div>

  <!-- Privacy Popup Modal -->
  <div id="privacy-popup" class="privacy-popup">
    <div class="popup-content">
      <button class="popup-close" onclick="closePrivacyPopup()">
        <i class="fas fa-times"></i>
      </button>
      <h4 id="popup-title"></h4>
      <div id="popup-explanation"></div>
      <div id="popup-suggestion" class="suggestion-box"></div>
      <button id="popup-apply-btn" class="btn btn-success" style="display: none;">
        <i class="fas fa-check"></i> Apply This Fix
      </button>
    </div>
  </div>

  <!-- Consent Popup Modal -->
  <div id="consent-popup" class="consent-popup">
    <div class="popup-content">
      <button class="popup-close" onclick="closeConsentPopup()">
        <i class="fas fa-times"></i>
      </button>
      <h4><i class="fas fa-user-shield"></i> Research Data Sharing</h4>
      <div class="consent-explanation">
        <p>Would you like to share your original conversation for research purposes?</p>
        
        <div class="consent-section">
          <h5><i class="fas fa-info-circle"></i> What this means:</h5>
          <ul>
            <li>Your conversation with the chatbot will be used for academic research</li>
            <li>All data will be anonymized and kept confidential</li>
            <li>Your participation helps improve AI privacy protection systems</li>
          </ul>
        </div>
      </div>
      <div class="consent-actions">
        <button id="consent-agree-btn" class="btn btn-success">
          <i class="fas fa-check"></i> Yes, I agree to share
        </button>
        <button id="consent-decline-btn" class="btn btn-secondary">
          <i class="fas fa-times"></i> No, I decline
        </button>
      </div>
    </div>
  </div>

  <!-- Prolific ID Popup Modal -->
  <div id="prolific-id-popup" class="prolific-id-popup">
    <div class="popup-content">
      <button class="popup-close" onclick="closeProlificIdPopup()">
        <i class="fas fa-times"></i>
      </button>
      <h4><i class="fas fa-id-card"></i> Welcome to the Privacy Demo</h4>
      <div class="prolific-id-explanation">
        <p>Before we begin, please enter your Prolific ID to continue with the study.</p>
        <p><strong>Your Prolific ID:</strong></p>
      </div>
      <div class="prolific-id-input">
        <input type="text" id="prolific-id-input" placeholder="Enter your Prolific ID here..." class="form-control">
      </div>
      <div class="prolific-id-actions">
        <button id="prolific-id-submit-btn" class="btn btn-success">
          <i class="fas fa-check"></i> Continue
        </button>
      </div>
    </div>
  </div>

  <!-- Post-Task Survey Modal -->
  <div id="survey-popup" class="survey-popup">
    <div class="popup-content">
      <button class="popup-close" onclick="closeSurveyPopup()">
        <i class="fas fa-times"></i>
      </button>
      <h4><i class="fas fa-clipboard-list"></i> Post-Task Survey</h4>
      <div class="survey-container">
        <p class="survey-intro">Please complete this brief survey to help us understand your experience. Your responses will be included in the exported data.</p>
        
        <form id="survey-form">
          <div class="survey-question">
            <label for="q1">What influenced your decision to share or withhold certain information?</label>
            <textarea id="q1" name="q1" class="form-control" rows="3" placeholder="Please describe what factors influenced your decisions..."></textarea>
          </div>

          <div class="survey-question">
            <label for="q2">How comfortable did you feel during the chatbot interaction?</label>
            <select id="q2" name="q2" class="form-control">
              <option value="">Select your comfort level...</option>
              <option value="Very comfortable">Very comfortable</option>
              <option value="Comfortable">Comfortable</option>
              <option value="Neutral">Neutral</option>
              <option value="Uncomfortable">Uncomfortable</option>
              <option value="Very uncomfortable">Very uncomfortable</option>
            </select>
          </div>

          <div class="survey-question">
            <label for="q3">How did the presence or absence of the privacy feature affect your sharing?</label>
            <textarea id="q3" name="q3" class="form-control" rows="3" placeholder="Please describe how privacy features influenced your sharing behavior..."></textarea>
          </div>

          <div class="survey-question">
            <label for="q4">Do you have general concerns about AI and privacy?</label>
            <textarea id="q4" name="q4" class="form-control" rows="3" placeholder="Please share your thoughts on AI and privacy concerns..."></textarea>
          </div>

          <div class="survey-question">
            <label for="q5">What is your age group?</label>
            <select id="q5" name="q5" class="form-control">
              <option value="">Select your age group...</option>
              <option value="18-29">18-29</option>
              <option value="30-39">30-39</option>
              <option value="40-49">40-49</option>
              <option value="50-59">50-59</option>
              <option value=">=60">>=60</option>
              <option value="Prefer not to disclose">Prefer not to disclose</option>
            </select>
          </div>

          <div class="survey-question">
            <label for="q6">What is your gender?</label>
            <select id="q6" name="q6" class="form-control">
              <option value="">Select your gender...</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Non-binary">Non-binary</option>
              <option value="Prefer not to disclose">Prefer not to disclose</option>
            </select>
          </div>

          <div class="survey-question">
            <label for="q7">What is your race and ethnicity?</label>
            <select id="q7" name="q7" class="form-control">
              <option value="">Select your race and ethnicity...</option>
              <option value="Black">Black</option>
              <option value="White">White</option>
              <option value="Asian">Asian</option>
              <option value="Hispanic">Hispanic</option>
              <option value="Native American">Native American</option>
              <option value="Prefer not to disclose">Prefer not to disclose</option>
            </select>
          </div>

          <div class="survey-question">
            <label for="q8">What is your educational level?</label>
            <select id="q8" name="q8" class="form-control">
              <option value="">Select your educational level...</option>
              <option value="No diploma or less than 12th grade">No diploma or less than 12th grade</option>
              <option value="High school">High school</option>
              <option value="College level">College level</option>
              <option value="Associate's degree">Associate's degree</option>
              <option value="Bachelor's degree">Bachelor's degree</option>
              <option value="Graduate or professional degree">Graduate or professional degree</option>
            </select>
          </div>

          <div class="survey-actions">
            <button type="submit" id="survey-submit-btn" class="btn btn-success">
              <i class="fas fa-check"></i> Complete Survey & Export
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Congratulation Popup Modal -->
  <div id="congratulation-popup" class="congratulation-popup">
    <div class="popup-content">
      <button class="popup-close" onclick="closeCongratulationPopup()">
        <i class="fas fa-times"></i>
      </button>
      <h4 id="congratulation-title"><i class="fas fa-trophy"></i> 🎉 Questions Completed!</h4>
      <div class="congratulation-message" id="congratulation-message">
        Great job! You've completed all the questions. You can now proceed to the next stage.
      </div>
      <div class="congratulation-actions">
        <button id="next-stage-btn" class="btn btn-success">
          <i class="fas fa-arrow-right"></i> Next Stage
        </button>
      </div>
    </div>
  </div>

  <!-- Privacy Tooltip Container -->
  <div id="privacy-tooltip-container" class="privacy-tooltip">
    <div class="tooltip-header">
      <span class="tooltip-title" id="tooltip-title">Privacy Issue</span>
    </div>
    <div class="tooltip-content">
      <div class="tooltip-explanation" id="tooltip-explanation">
        This text contains potentially sensitive information.
      </div>
      <div class="tooltip-suggestion" id="tooltip-suggestion" style="display: none;">
        <strong>Safer Version:</strong>
        <span id="tooltip-suggestion-text"></span>
      </div>
    </div>
    <div class="tooltip-actions">
      <button class="tooltip-btn apply" id="tooltip-apply-btn" style="display: none;">
        <i class="fas fa-check"></i> Apply
      </button>
      <button class="tooltip-btn close" id="tooltip-close-btn">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p id="loading-message">Processing...</p>
      <div id="loading-notifications" class="loading-notifications">
        <!-- Progress notifications will be added here dynamically -->
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="api.js"></script>
  <script src="script.js"></script>
</body>
</html> 